<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>스쿠버 다이빙 계산기</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: white;
      margin: 0;
      padding: 0;
    }
    .tab-container {
      display: flex;
      justify-content: center;
      margin-top: 20px;
      flex-wrap: wrap;
    }
    .tab-button {
      padding: 10px 20px;
      border: none;
      background-color: #eee;
      cursor: pointer;
      margin: 5px;
    }
    .tab-button.active {
      background-color: #ff4d4d;
      color: white;
    }
    .tab-content {
      display: none;
      padding: 20px;
    }
    .tab-content.active {
      display: block;
    }
    input {
      width: 90%;
      padding: 10px;
      margin-bottom: 10px;
      font-size: 1em;
    }
    button {
      padding: 10px 20px;
      font-size: 1em;
      background-color: #ff4d4d;
      color: white;
      border: none;
      cursor: pointer;
    }
    .output {
      margin-top: 15px;
      font-weight: bold;
      font-size: 1.1em;
    }
  </style>
</head>
<body>

  <div class="tab-container">
    <button class="tab-button active" onclick="switchTab('rmv-single')">RMV (싱글)</button>
    <button class="tab-button" onclick="switchTab('rmv-double')">RMV (더블)</button>
    <button class="tab-button" onclick="switchTab('nitrox')">나이트록스</button>
    <button class="tab-button" onclick="switchTab('trimix')">트라이믹스</button>
  </div>

  <!-- RMV (싱글) -->
  <div id="rmv-single" class="tab-content active">
    <h3>RMV 계산기 (싱글 탱크 11L)</h3>
    <input id="s1" placeholder="입수 탱크압력 (bar)" type="number" />
    <input id="s2" placeholder="출수 탱크압력 (bar)" type="number" />
    <input id="s3" placeholder="평균수심 (m)" type="number" />
    <input id="s4" placeholder="다이빙시간 (분)" type="number" />
    <button onclick="calcRMVSingle()">계산하기</button>
    <div class="output" id="s-result"></div>
  </div>

  <!-- RMV (더블) -->
  <div id="rmv-double" class="tab-content">
    <h3>RMV 계산기 (더블탱크 22L + 데코탱크 최대 3개)</h3>
    <input id="d1" placeholder="입수 탱크압력 (bar)" type="number" />
    <input id="d2" placeholder="출수 탱크압력 (bar)" type="number" />
    <input id="d3" placeholder="평균수심 (m)" type="number" />
    <input id="d4" placeholder="다이빙시간 (분)" type="number" />
    <hr />
    <p>데코탱크 1 (11L)</p>
    <input id="d5" placeholder="입수압력 (bar)" type="number" />
    <input id="d6" placeholder="출수압력 (bar)" type="number" />
    <p>데코탱크 2 (11L)</p>
    <input id="d7" placeholder="입수압력 (bar)" type="number" />
    <input id="d8" placeholder="출수압력 (bar)" type="number" />
    <p>데코탱크 3 (11L)</p>
    <input id="d9" placeholder="입수압력 (bar)" type="number" />
    <input id="d10" placeholder="출수압력 (bar)" type="number" />
    <button onclick="calcRMVDouble()">계산하기</button>
    <div class="output" id="d-result"></div>
  </div>

  <!-- 나이트록스 -->
  <div id="nitrox" class="tab-content">
    <h3>나이트록스 MOD 계산기</h3>
    <input id="n1" placeholder="산소 비율 (%)" type="number" />
    <input id="n2" placeholder="최대 PO₂ (기본: 1.4)" type="number" value="1.4" />
    <button onclick="calcMOD()">계산하기</button>
    <div class="output" id="n-result"></div>
  </div>

  <!-- 트라이믹스 -->
  <div id="trimix" class="tab-content">
    <h3>트라이믹스 계산기</h3>
    <input id="t1" placeholder="목표 수심 (m)" type="number" />
    <input id="t2" placeholder="목표 END (m)" type="number" />
    <input id="t3" placeholder="총 충전압력 (bar)" type="number" />
    <button onclick="calcTrimix()">계산하기</button>
    <div class="output" id="t-result"></div>
  </div>

  <script>
    function switchTab(id) {
      document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      event.target.classList.add('active');
    }

    function calcRMVSingle() {
      const start = parseFloat(document.getElementById('s1').value);
      const end = parseFloat(document.getElementById('s2').value);
      const depth = parseFloat(document.getElementById('s3').value);
      const time = parseFloat(document.getElementById('s4').value);
      if (isNaN(start) || isNaN(end) || isNaN(depth) || isNaN(time)) return;
      const used = (start - end) * 11;
      const atm = depth / 10 + 1;
      const rmv = Math.round((used / time / atm) * 10) / 10;
      document.getElementById('s-result').textContent = `RMV = ${rmv} L`;
    }

    function calcRMVDouble() {
      const start = parseFloat(document.getElementById('d1').value);
      const end = parseFloat(document.getElementById('d2').value);
      const depth = parseFloat(document.getElementById('d3').value);
      const time = parseFloat(document.getElementById('d4').value);
      const deco = [[d5,d6],[d7,d8],[d9,d10]].map(([i1, i2]) =>
        Math.max(0, (parseFloat(document.getElementById(i1.id).value || 0) - parseFloat(document.getElementById(i2.id).value || 0)) * 11)
      );
      if (isNaN(start) || isNaN(end) || isNaN(depth) || isNaN(time)) return;
      const mainUsed = (start - end) * 22;
      const totalUsed = mainUsed + deco.reduce((a,b)=>a+b,0);
      const atm = depth / 10 + 1;
      const rmv = Math.round((mainUsed / time / atm) * 10) / 10;
      document.getElementById('d-result').textContent = `RMV = ${rmv} L (총 사용량: ${totalUsed} L)`;
    }

    function calcMOD() {
      const o2 = parseFloat(document.getElementById('n1').value) / 100;
      const ppo2 = parseFloat(document.getElementById('n2').value);
      if (isNaN(o2) || isNaN(ppo2) || o2 === 0) return;
      const mod = Math.floor(((ppo2 / o2) - 1) * 10);
      document.getElementById('n-result').textContent = `MOD = ${mod} m`;
    }

    function calcTrimix() {
      const depth = parseFloat(document.getElementById('t1').value);
      const end = parseFloat(document.getElementById('t2').value);
      const total = parseFloat(document.getElementById('t3').value);
      const pp_end = (end * 0.1 + 1) * 0.79;
      const pp_depth = depth * 0.1 + 1;
      const n2 = Math.round((pp_end / pp_depth) * 100);
      const o2 = 20;
      const he = 100 - o2 - n2;
      const mixHe = Math.ceil(he / 5) * 5;
      const mix = `TX ${o2} / ${mixHe}`;
      const eanx = o2 / (1 - mixHe / 100);
      const o2Bar = Math.round((eanx - 0.21) / 0.79 * (total - mixHe));
      const heBar = Math.round((total * mixHe) / 100);
      const airBar = total - o2Bar - heBar;
      document.getElementById('t-result').innerHTML =
        `추천 혼합가스: ${mix}<br>산소: ${o2}%<br>헬륨: ${mixHe}%<br>질소: ${100 - o2 - mixHe}%<br><br>` +
        `EAN_x = ${eanx.toFixed(2)}<br><br>총 압력: ${total} bar<br>` +
        `- O₂ 주입압력: ${o2Bar} bar<br>- He 주입압력: ${heBar} bar<br>- Air 주입압력: ${airBar} bar`;
    }
  </script>
</body>
</html>
